<!DOCTYPE html>
<html>
	<head>
		<title>Geohackers</title>
		<script src="babylon.2.3.js"></script>
		<script src="data/compileddata.js"></script>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
		<link rel="stylesheet" href="style.css">
	</head>
	<body>
		<script type="application/vertexShader" id="vertexShaderCode">
			precision highp float;

			// Attributes
			attribute vec3 position;
			attribute vec3 normal;
			attribute vec2 uv;

			// Uniforms
			uniform mat4 worldViewProjection;
			uniform float time;
			uniform mat4 lightMatrix0;
			uniform mat4 world;


			// Varying
			varying vec3 vPosition;
			varying vec3 vNormal;
			varying vec2 vUV;
			varying vec4 vPositionFromLight0;
			varying float vHeight;

			uniform float amt1;
			uniform float amt2;
			uniform sampler2D img1;
			uniform sampler2D img2;

			float H(vec2 dd) {

				float outheight =
					texture2D(img1, uv + dd).r * amt1 +
					texture2D(img2, uv + dd).r * amt2;

				return outheight;
			}

			void main(void) {

				float outheight = H(vec2(0,0));

				vec3 v = position;
				v.y += outheight * 2.0;

				vec4 worldPos = world * vec4(v, 1.0);

				gl_Position = worldViewProjection * worldPos;

				vPositionFromLight0 = lightMatrix0 * worldPos;

				float R = 0.01;
				float dx = H(vec2(R,0)) - H(vec2(-R,0));
				float dy = H(vec2(0,R)) - H(vec2(0,-R));

				vPosition = position;
				vNormal = normalize(vec3(dx,dy,0.1));
				vUV = uv;
				vHeight = outheight;
			}
		</script>
		<script type="application/fragmentShader" id="fragmentShaderCode">
			precision highp float;

			// Varying
			varying vec3 vPosition;
			varying vec3 vNormal;
			varying vec2 vUV;
			varying vec4 vPositionFromLight0;

			// Uniforms
			uniform mat4 world;
			uniform mat4 worldView;

			// Refs
			uniform vec3 cameraPosition;
			uniform sampler2D textureSampler;
			uniform sampler2D shadowSampler;
			uniform vec2 depthValues;
			varying float vHeight;

			uniform float debugamt;
			uniform float time;

			uniform float amt1;
			uniform float amt2;
			uniform sampler2D img1;
			uniform sampler2D img2;

			float unpack(vec4 color) {
				const vec4 bit_shift = vec4(1.0 / (255.0 * 255.0 * 255.0), 1.0 / (255.0 * 255.0), 1.0 / 255.0, 1.0);
				return dot(color, bit_shift);
			}

			void main(void) {
				vec3 vLightPosition = vec3(
					3.0, // *sin(9.0 * time),
					1.0, // 3.0,
					2.0 // 3.0*cos(8.0 * time)
					);

				// World values
				vec3 vLightPositionW = vec3(worldView * vec4(vLightPosition, 1.0));
				vec3 vPositionW = vec3(world * vec4(vPosition, 1.0));
				vec3 vNormalW = normalize(vec3(world * vec4(vNormal, 0.0)));
				vec3 viewDirectionW = normalize(cameraPosition - vPositionW);

				// Light
				vec3 lightVectorW = normalize(vLightPosition - vPositionW);

				// diffuse
				float ndl = max(0., dot(vNormal, lightVectorW));
				//float ndl = 1.0;

				//Shadow - brightness
				float bri;
				vec3 directionToLight = vPositionW.xyz - vLightPosition;

				float depth = length(directionToLight)*1000.;

				vec3 color = texture2D(textureSampler, vUV).rgb;

				// Specular
				vec3 angleW = normalize(viewDirectionW + lightVectorW);
				float specComp = max(0., dot(vNormalW, angleW));
				specComp = pow(specComp, max(1., 64.)) * 2.;

				if (debugamt > 0.5) {
					color *= 0.5;
					color += vec3(vHeight, vHeight, vHeight);
				}

				// color += vNormal;

				gl_FragColor = vec4(color * ndl + vec3(specComp), 1.0);
				// max(0.0, min(1.0, 6.0 - length(vUV - 0.5) * 12.0)) );

				// gl_FragColor = vec4(lightVectorW, 1.0);

			}
		</script>
		<!-- <img src="res/avatar.png" style="position: absolute; left: 10px; top:10px; width: 110px; height: 110px">
		<pre id="taag_output_text" style="float:left;" class="fig" contenteditable="true">
			 _____            _                _
			/ ____|          | |              | |
		 | |  __  ___  ___ | |__   __ _  ___| | _____ _ __ ___
		 | | |_ |/ _ \/ _ \| '_ \ / _` |/ __| |/ / _ \ '__/ __|
		 | |__| |  __/ (_) | | | | (_| | (__|   &lt;  __/ |  \__ \
		  \_____|\___|\___/|_| |_|\__,_|\___|_|\_\___|_|  |___/
		</pre>
		-->
		<ul id="buttoncnt"></ul>
		<p id="coder">
			<input id="amt1" type="range" /> Layer 1 Amt
			<input id="amt2" type="range" /> Layer 2 Amt
			<input id="däbüg" type="checkbox" /> Degaüss
		</p>

		<canvas id="renderCanvas"></canvas>


		<i id="cogs" class="fa fa-cog"></i>

		<!--<div style="position: absolute; bottom: 0px; width: 100%">
			<img src="res/moske.png" style="position: relative; margin: 0 auto; height: 300px; display: block">
		</div>
		<div style="position: absolute; bottom: 88px; width: 100%;">
			<div style="position: relative; margin: 0 auto; display: block; width: 7.1em">
				
			</div>
		</div>
		<div class="buttons left">
			<div>
				<img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTVgJIYAvD7Z00wWqlzobzN3oz_CrmEU8dKIAd4xYH4EzaLqdrjgg">
				<p>Dataset 1</p>
			</div>

			<div>
				<img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTVgJIYAvD7Z00wWqlzobzN3oz_CrmEU8dKIAd4xYH4EzaLqdrjgg">
				<p>Dataset 2</p>
			</div>

			<div>
				<img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTVgJIYAvD7Z00wWqlzobzN3oz_CrmEU8dKIAd4xYH4EzaLqdrjgg">
				<p>Dataset 3</p>
			</div>
		</div>
		<div class="buttons right">
			<div>
				<img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTVgJIYAvD7Z00wWqlzobzN3oz_CrmEU8dKIAd4xYH4EzaLqdrjgg">
				<p>Dataset 4</p>
			</div>

			<div>
				<img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTVgJIYAvD7Z00wWqlzobzN3oz_CrmEU8dKIAd4xYH4EzaLqdrjgg">
				<p>Dataset 5</p>
			</div>

			<div>
				<img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTVgJIYAvD7Z00wWqlzobzN3oz_CrmEU8dKIAd4xYH4EzaLqdrjgg">
				<p>Dataset 6</p>
			</div>
		</div>-->
		<script src="app.js"></script>
		<script src="dal.js"></script>
	</body>
</html>